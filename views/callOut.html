<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>CRM系统</title>
		<meta name="author" content="WLL">
		<% include ./components/scriptCSS.html %>
		<% include ./components/scriptJS.html %>
		<!-- The HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<!-- The fav icon -->
		<link rel="shortcut icon" href="assets/images/favicon.ico">
	</head>
	<body class='contrast-red'>
		<style>
			html { overflow-x: hidden; overflow-y: auto; }
		</style>
		<% include ./components/topBar.html %>
		<div id='wrapper'>
			<div id='main-nav-bg'></div>
			<% include ./components/leftMenu.html %>
			<% include ./components/noScript.html %>
			<section id='content'>
				<div class='container-fluid'>
					<div class='row-fluid' id='content-wrapper'>
						<div class='span12'>
							<div class='page-header'>
								<h1 class='pull-left'>
        							<i class='icon-dashboard'></i>
        							<span>呼叫管理</span>
   			 					</h1>
								<div class='pull-right'>
									<ul class='breadcrumb'>
	                                    <li>
	                                        <a href="index"><i class='icon-bar-chart'></i>
	                                        </a>
	                                    </li>
	                                    <li class='separator'>
	                                        <i class='icon-angle-right'></i>
	                                    </li>
	                                    <li>
	                                       呼叫管理
	                                    </li>
	                                    <li class='separator'>
	                                        <i class='icon-angle-right'></i>
	                                    </li>
	                                    <li>
	                                       呼出管理
	                                    </li>
	                                </ul>
								</div>
							</div>
							<div class='row-fluid'>
								<div class="span12 box ">
	                                <a>坐席工号：</a>
	                                <input class="" placeholder="请输入坐席工号" id="_ani" type="text">
	                                &nbsp;&nbsp;
	                                <a>顾客电话：</a>
	                                <input class="" placeholder="请输入顾客电话" id="_dnis" type="text">
	                                <button id="queryBut" class="btn btn-primary btn-success">
			                            <i class="icon-search"></i>
			                            	查询
			                        </button>
								</div>
								<div class='span12 box bordered-box blue-border' style='margin-bottom:0;'>
									<div class='box-header blue-background'>
										<div class='title'>呼出管理</div>
										<div class='actions'>
											<a href="#" class="btn box-remove btn-mini btn-link"><i class='icon-remove'></i>
											</a>
											<a href="#" class="btn box-collapse btn-mini btn-link"><i></i>
											</a>
										</div>
									</div>
									<div class='box-content box-no-padding'>
										<div class='responsive-table'>
											<div class='scrollable-area'>
												<table  id="havaTable"  class='table' style='margin-bottom:0;'>
													<thead>
														<tr>
															<th>
																编号
															</th>
															<th>
																顾客电话
															</th>
															<th>
																呼出时间
															</th>
															<th>
																结束时间
															</th>
															<th>
																挂断方式
															</th>
															<th>
																操作
															</th>
														</tr>
													</thead>
													<tbody>
														<template>
															<tr v-for="todo in todos" >
																<td v-text="todo.id"></td>
																<td v-text="todo.dnis"></td>
																<td v-text="todo.begin_time"></td>
																<td v-text="todo.end_time"></td>
																<td v-text="todo.end_type_name"></td>
																<td>
																	<a class='btn btn-success btn-mini' href='#'>
																		<i class='icon-edit'></i>
																	</a>
																	<a class='btn btn-success btn-mini' href='#'>
																		<i class='icon-ok'></i>
																	</a>
																	<a class='btn btn-danger btn-mini' href='#'>
																		<i class='icon-remove'></i>
																	</a>
																</td>
															</tr>
														</template>
													</tbody>
												</table>
												<div class="span6 text-right">
													<div class="dataTables_paginate paging_bootstrap pagination pagination-small">
														<ul>
															<li class="prev disabled">
																<a href="#">← Previous</a>
															</li>
															<li class="active">
																<a href="#">1</a>
															</li>
															<li class="next disabled">
																<a href="#">Next → </a>
															</li>
														</ul>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<script type="text/javascript">
	       $(function(){
	       		function spliceGetStr(params){//拼接get请求
	       			var strTemp="";
	       			for (var variable in params) {
	       				strTemp+=variable+"="+params[variable]+"&"
	       			}
	       			if(strTemp.length>0){
	       				strTemp=strTemp.substr(0,strTemp.length-1);
	       			}
	       			return strTemp;
	       		}
		        $("#queryBut").click(function(){
			    	var params ={
		    			_ani: $("#_ani").val(),
		    			_dnis: $("#_dnis").val(),
		    			pageNo:1,
		    			pageSize:99,
		    			token:"crm"
		    		};
		    		var paramsGetStr="?"+spliceGetStr(params);
		    		var userAllInfo=$.session.get("loginUserAllInfo_crm");
			   		var userAllInfoJson=$.parseJSON(userAllInfo);
			        var sessionId=userAllInfoJson["id"];//返回的还是一个json对象
			        var user=userAllInfoJson["user"];
			        var user_id=user["id"];
		    		var _headers= {
						"sessionId":sessionId,
						"user_id":user_id,
						"call_type":"1"
					}
			    	$.ajax({
					    url:'http://localhost:7006/record/'+paramsGetStr,
					    type:'get',
					    dataType:'text',
					    headers:_headers,
					    success: function(_data){
					    	var infoRes=$.parseJSON(_data);//返回的数据，包含时间戳等
				        	var infoData=infoRes["data"];//取到data
				        	if(infoData==""){
				        		alert("查询为空");
				        	}else{
				        		new Vue({
					   				el:"#havaTable",
					   				data:{
					   					todos:infoData
					   				}
					   			});
				        	}
					    },
					    error: function(res){
			            	alert("查询失败");
			            }
					});
	    		});
			});
	    </script>
	</body>
</html>